
<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>utilidades.basedatos.GestorBD &#8212; documentación de Modulo de utilidades para Python - 1.0</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/translations.js"></script>
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Código fuente para utilidades.basedatos.GestorBD</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># coding=utf-8</span>

<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">.ConstantesBaseDatosSQLite</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="GestorBD"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD">[documentos]</a><span class="k">class</span> <span class="nc">GestorBD</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archivo_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archivo_db</span><span class="o">=</span><span class="n">archivo_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conexion</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archivo_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conexion</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">([</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>        
    <span class="k">def</span> <span class="nf">get_preludio_sql</span><span class="p">(</span><span class="n">nombre_funcion</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PRELUDIO_SQL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nombre_funcion</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">crear_sentencia_update</span><span class="p">(</span><span class="n">sentencia</span><span class="p">):</span>
        <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">sql=</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">sentencia</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
        <span class="n">sql</span><span class="o">+=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">db.Execute sql, dbFailOnError</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">sql</span>
    
    <span class="k">def</span> <span class="nf">crear_tabla_itinerancias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_tabla</span><span class="o">=</span><span class="n">NOMBRE_TABLA_ITINERANCIAS</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">SQL_CREACION_PLANTILLAS</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span> <span class="n">nombre_tabla</span> <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_procedimiento</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">sql_intermedio</span><span class="p">):</span>
        <span class="n">inicio</span><span class="o">=</span><span class="n">GestorBD</span><span class="o">.</span><span class="n">get_preludio_sql</span><span class="p">(</span><span class="n">nombre</span><span class="p">)</span>
        <span class="n">fin</span><span class="o">=</span><span class="n">GestorBD</span><span class="o">.</span><span class="n">get_fin_sql</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">inicio</span><span class="o">+</span><span class="n">sql_intermedio</span><span class="o">+</span><span class="n">fin</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_fin_sql</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">FIN_SQL_ACCESS</span>
    
<div class="viewcode-block" id="GestorBD.activar_depuracion"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.activar_depuracion">[documentos]</a>    <span class="k">def</span> <span class="nf">activar_depuracion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activa la depuración SQL&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span></div>
        
<div class="viewcode-block" id="GestorBD.desactivar_depuracion"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.desactivar_depuracion">[documentos]</a>    <span class="k">def</span> <span class="nf">desactivar_depuracion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activa la depuración SQL&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span></div>
        
<div class="viewcode-block" id="GestorBD.get_unico_valor"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.get_unico_valor">[documentos]</a>    <span class="k">def</span> <span class="nf">get_unico_valor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql_con_valor_unico</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Devuelve el valor que hay dentro de un SELECT</span>
<span class="sd">        que devuelve un solo valor</span>
<span class="sd">        </span>
<span class="sd">            Argumentos:</span>
<span class="sd">            </span>
<span class="sd">                sql_con_valor_unico -- Sentencia SELECT que se supone que</span>
<span class="sd">                extrae UNA ÚNICA FILA y de esa ÚNICA FILA extrae UN SOLO CAMPO&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">sql_con_valor_unico</span><span class="p">)</span>
        <span class="n">filas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filas</span><span class="p">(</span><span class="n">sql_con_valor_unico</span><span class="p">)</span>
        <span class="c1">#print(filas)</span>
        <span class="k">return</span> <span class="n">filas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="GestorBD.ejecutar_sentencias"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.ejecutar_sentencias">[documentos]</a>    <span class="k">def</span> <span class="nf">ejecutar_sentencias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lista_sentencias</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ejecuta varias sentencias SQL</span>
<span class="sd">        </span>
<span class="sd">            Argumentos:</span>
<span class="sd">            </span>
<span class="sd">                lista_sentencias -- Array con una lista de cadenas SQL con SELECTs&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">lista_sentencias</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">sql</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fallo la sentencia siguiente:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conexion</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="GestorBD.get_filas"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.get_filas">[documentos]</a>    <span class="k">def</span> <span class="nf">get_filas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extrae un conjunto de filas </span>
<span class="sd">        </span>
<span class="sd">            Argumentos:</span>
<span class="sd">            </span>
<span class="sd">                select -- Sentencia SELECT que recupera varias filas con varios campos&quot;&quot;&quot;</span>
        <span class="n">filas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filas</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span></div>
<div class="viewcode-block" id="GestorBD.cuantos_cumplen_select"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.cuantos_cumplen_select">[documentos]</a>    <span class="k">def</span> <span class="nf">cuantos_cumplen_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Devuelve el número de filas que devuelve un SELECT</span>
<span class="sd">        </span>
<span class="sd">            Argumentos:</span>
<span class="sd">            </span>
<span class="sd">                select -- Sentencia SQL SELECT&quot;&quot;&quot;</span>
        <span class="n">filas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filas</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">filas</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">get_descripcion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span>
        
<div class="viewcode-block" id="GestorBD.get_nombres_columnas"><a class="viewcode-back" href="../../../index.html#utilidades.basedatos.GestorBD.GestorBD.get_nombres_columnas">[documentos]</a>    <span class="k">def</span> <span class="nf">get_nombres_columnas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extrae los nombres de las columnas de la última sentencia SELECT&quot;&quot;&quot;</span>
        <span class="n">descripciones</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span>
        <span class="n">nombres_columnas</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descripciones</span><span class="p">:</span>
            <span class="n">nombres_columnas</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">nombres_columnas</span></div>
            
    <span class="k">def</span> <span class="nf">extraer_tuplas_especialidades_de_fichero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_fichero</span><span class="p">):</span>
        <span class="n">fichero</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">nombre_fichero</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">lineas</span><span class="o">=</span><span class="n">fichero</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">tuplas</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lineas</span><span class="p">:</span>
            <span class="n">codigo</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">descripcion</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">tuplas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">descripcion</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">fichero</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tuplas</span>
    
    <span class="k">def</span> <span class="nf">crear_tabla_todas_especialidades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_tabla_especialidades</span><span class="p">):</span>
        <span class="n">sql</span><span class="o">=</span><span class="n">SQL_CREACION_ESPECIALIDADES</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nombre_tabla_especialidades</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">([</span><span class="n">sql</span><span class="p">])</span>
        <span class="n">ficheros</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;590&quot;</span><span class="p">,</span> <span class="s2">&quot;591&quot;</span><span class="p">,</span> <span class="s2">&quot;592&quot;</span><span class="p">,</span> <span class="s2">&quot;594&quot;</span><span class="p">,</span> <span class="s2">&quot;595&quot;</span><span class="p">,</span> <span class="s2">&quot;596&quot;</span><span class="p">,</span> <span class="s2">&quot;597&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ficheros</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crear_tabla_especialidades</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nombre_tabla_especialidades</span><span class="p">)</span>
            
            
    <span class="k">def</span> <span class="nf">crear_tabla_especialidades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codigo_cuerpo</span><span class="p">,</span> <span class="n">nombre_tabla_especialidades</span><span class="p">):</span>
        <span class="n">f</span><span class="o">=</span><span class="n">codigo_cuerpo</span>
        <span class="n">sql</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">dir_actual</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">ruta_fichero</span><span class="o">=</span><span class="n">dir_actual</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;Especialidades0</span><span class="si">{0}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">especialidades</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extraer_tuplas_especialidades_de_fichero</span><span class="p">(</span> <span class="n">ruta_fichero</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">tupla</span> <span class="ow">in</span> <span class="n">especialidades</span><span class="p">:</span>
            <span class="n">codigo</span><span class="o">=</span><span class="n">tupla</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nombre</span><span class="o">=</span><span class="n">tupla</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;0</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;ESPAÑOL&#39;, &#39;NO&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;P</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;ESPAÑOL&#39;, &#39;SI&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;B</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;INGLÉS&#39;, &#39;NO&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;W</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;INGLÉS&#39;, &#39;SI&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;R</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;FRANCÉS&#39;, &#39;SI&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="c1">#                                                  Codigo    Nombre Idioma   ¿tiempo parcial?</span>
            <span class="n">insert</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;F</span><span class="si">{2}{0}</span><span class="s2">&#39;, &#39;</span><span class="si">{1}</span><span class="s2">&#39;, &#39;FRANCÉS&#39;, &#39;NO&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_sql_especialidades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sql</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">insert_primaria</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;PRIMARIA&#39;, &#39;DESCONOCIDA&#39;, &#39;ESPAÑOL&#39;, &#39;NO&#39;)&quot;</span>
        <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert_primaria</span><span class="p">)</span>
        <span class="n">insert_secundaria</span><span class="o">=</span><span class="s2">&quot;insert or ignore into especialidades values (&#39;SECUNDARIA&#39;, &#39;DESCONOCIDA&#39;, &#39;ESPAÑOL&#39;, &#39;NO&#39;)&quot;</span>
        <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insert_secundaria</span><span class="p">)</span>
        <span class="n">ficheros</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;590&quot;</span><span class="p">,</span> <span class="s2">&quot;591&quot;</span><span class="p">,</span> <span class="s2">&quot;592&quot;</span><span class="p">,</span> <span class="s2">&quot;594&quot;</span><span class="p">,</span> <span class="s2">&quot;595&quot;</span><span class="p">,</span> <span class="s2">&quot;596&quot;</span><span class="p">,</span> <span class="s2">&quot;597&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ficheros</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crear_tabla_especialidades</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;especialidades&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sql</span>
    
    <span class="k">def</span> <span class="nf">crear_tablas_iniciales_en_bd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">([</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">([</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crear_tabla_todas_especialidades</span><span class="p">(</span><span class="s2">&quot;especialidades&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">([</span> <span class="n">SQL_CREACION_NOMBRAMIENTOS</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span> <span class="p">(</span> <span class="n">BD_RESULTADOS</span><span class="o">.</span><span class="n">get_sql_especialidades</span><span class="p">()</span> <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cambiar_nombres_por_codigos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_tabla_rutas</span><span class="p">,</span> <span class="n">nombre_tabla_localidades</span><span class="p">):</span>
        <span class="n">sql_localidades</span><span class="o">=</span><span class="s2">&quot;select nombre_localidad from </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span> <span class="n">nombre_tabla_localidades</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">sql_localidades</span><span class="p">)</span>
        <span class="n">filas_localidades</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filas</span> <span class="p">(</span> <span class="n">sql_localidades</span> <span class="p">)</span>
        <span class="n">sql_extractor_codigo</span><span class="o">=</span><span class="s2">&quot;select codigo_localidad from </span><span class="si">{0}</span><span class="s2"> where nombre_localidad=&#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span>
        <span class="n">sentencias_update</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">localidad</span> <span class="ow">in</span> <span class="n">filas_localidades</span><span class="p">:</span>
            <span class="n">codigo_localidad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unico_valor</span> <span class="p">(</span> <span class="n">sql_extractor_codigo</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">nombre_tabla_localidades</span><span class="p">,</span> <span class="n">localidad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">),</span> <span class="s1">&#39;codigo_localidad&#39;</span><span class="p">)</span>
            <span class="n">sql_update</span><span class="o">=</span><span class="s2">&quot;update </span><span class="si">{0}</span><span class="s2"> set origen=&#39;</span><span class="si">{1}</span><span class="s2">&#39; where origen=&#39;</span><span class="si">{2}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
                <span class="n">nombre_tabla_rutas</span><span class="p">,</span> <span class="n">codigo_localidad</span><span class="p">,</span> <span class="n">localidad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">sentencias_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sql_update</span><span class="p">)</span>
            <span class="n">sql_update</span><span class="o">=</span><span class="s2">&quot;update </span><span class="si">{0}</span><span class="s2"> set destino=&#39;</span><span class="si">{1}</span><span class="s2">&#39; where destino=&#39;</span><span class="si">{2}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
                <span class="n">nombre_tabla_rutas</span><span class="p">,</span> <span class="n">codigo_localidad</span><span class="p">,</span> <span class="n">localidad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">sentencias_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sql_update</span><span class="p">)</span>
            
        <span class="n">excepciones</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;130360002&quot;</span><span class="p">,</span> <span class="s2">&quot;Cortijos de Arriba&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;130360002&quot;</span><span class="p">,</span> <span class="s2">&quot;Cortijo de Arriba&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">tupla</span> <span class="ow">in</span> <span class="n">excepciones</span><span class="p">:</span>
            <span class="n">codigo_localidad</span><span class="o">=</span><span class="n">tupla</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">localidad</span><span class="o">=</span><span class="n">tupla</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">sql_update</span><span class="o">=</span><span class="s2">&quot;update </span><span class="si">{0}</span><span class="s2"> set origen=&#39;</span><span class="si">{1}</span><span class="s2">&#39; where origen=&#39;</span><span class="si">{2}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
                <span class="n">nombre_tabla_rutas</span><span class="p">,</span> <span class="n">codigo_localidad</span><span class="p">,</span> <span class="n">localidad</span>
            <span class="p">)</span>
            <span class="n">sentencias_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sql_update</span><span class="p">)</span>
            <span class="n">sql_update</span><span class="o">=</span><span class="s2">&quot;update </span><span class="si">{0}</span><span class="s2"> set destino=&#39;</span><span class="si">{1}</span><span class="s2">&#39; where destino=&#39;</span><span class="si">{2}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
                <span class="n">nombre_tabla_rutas</span><span class="p">,</span> <span class="n">codigo_localidad</span><span class="p">,</span> <span class="n">localidad</span>
            <span class="p">)</span>
            <span class="n">sentencias_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sql_update</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ejecutar_sentencias</span><span class="p">(</span><span class="n">sentencias_update</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Modulo de utilidades para Python</a></h1>








<h3>Navegación</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, None.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>